<%- include("templates/headerAuthenticated") %>

<br>
<div class="text-center">
    <h1> üè• Dashboard üè• </h1>
</div>
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body d-flex justify-content-between">
                    <div>
                        <strong>Drones in Inventory:</strong> 15
                    </div>
                    <div>
                        <strong>Drones Out and Active:</strong> 5
                    </div>
                    <div>
                        <strong>Pending Emergency Requests:</strong> <%= requestedEmergencies.length %>
                    </div>
                    <div>
                        <strong>Completed Emergencies:</strong> <%= completeEmergencies.length %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Emergency Requests -->
        <div class="col-12 col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0 text-center">Requested Emergencies</h4>
                </div>
                <% requestedEmergencies.slice(0, 3).forEach(rem => { %>
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <strong class="mb-0"><%= rem.username %></strong>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#emergencyModal<%= rem._id %>">View More</button>
                    </div>
                <% }); %>
            </div>
        </div>

        <!-- Ongoing Emergencies -->
        <div class="col-12 col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0 text-center">Active Emergencies</h4>
                </div>
                <% activeEmergencies.slice(0, 3).forEach(aem => { %>
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <strong class="mb-0"><%= aem.username %></strong>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#activeModal<%= aem._id %>">View More</button>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <!-- Completed Emergencies -->
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0 text-center">Completed Emergencies</h4>
                </div>
                <% completeEmergencies.slice(0, 3).forEach(cem => { %>
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <strong class="mb-0"><%= cem.username %></strong>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#completedModal<%= cem._id %>">View More</button>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>

    <!-- Emergency Modals -->
    <% requestedEmergencies.concat(activeEmergencies).concat(completeEmergencies).forEach(em => { %>
        <div class="modal fade" id="emergencyModal<%= em._id %>" tabindex="-1" role="dialog" aria-labelledby="emergencyModalLabel<%= em._id %>" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title" id="emergencyModalLabel<%= em._id %>">Emergency Information</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li><strong>User ID:</strong> <%= em.userId %></li>
                            <li><strong>Emergency ID:</strong> <%= em._id %></li>
                            <li><strong>Location:</strong> <%= em.location %></li>
                            <li><strong>Timestamp:</strong> <%= em.time %></li>
                            <li><strong>Status:</strong> <%= em.status %></li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <% }); %>

    <!-- Ongoing Modal -->
    <% activeEmergencies.forEach(aem => { %>
        <div class="modal fade" id="ongoingModal<%= aem._id %>" tabindex="-1" role="dialog" aria-labelledby="ongoingModalLabel<%= aem._id %>" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title" id="ongoingModalLabel<%= aem._id %>">Ongoing Emergency Information</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li><strong>User ID:</strong> <%= aem.userId %></li>
                            <li><strong>Emergency ID:</strong> <%= aem._id %></li>
                            <li><strong>Location:</strong> <%= aem.location %></li>
                            <li><strong>Timestamp:</strong> <%= aem.time %></li>
                            <li><strong>Status:</strong> <%= aem.status %></li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <% }); %>

    <!-- Completed Modal -->
    <% completeEmergencies.forEach(cem => { %>
        <div class="modal fade" id="completedModal<%= cem._id %>" tabindex="-1" role="dialog" aria-labelledby="completedModalLabel<%= cem._id %>" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title" id="completedModalLabel<%= cem._id %>">Completed Emergency Information</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li><strong>User ID:</strong> <%= cem.userId %></li>
                            <li><strong>Emergency ID:</strong> <%= cem._id %></li>
                            <li><strong>Location:</strong> <%= cem.location %></li>
                            <li><strong>Timestamp:</strong> <%= cem.time %></li>
                            <li><strong>Status:</strong> <%= cem.status %></li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <% }); %>
</div>

<%- include("templates/footerAuthenticatedOrg") %>
